___
Теги: #plan #idea 
Дата создания: 2023-08-29 23:02 
Последнее изменение: вторник 29-го августа 2023 23:02:21
<< [[2023-08-28]] | [[2023-08-30]] >> 
___
## 1. Сети

По-хорошему, нужно изолировать сети друг и не давать локальной машине пинговать контейнеры.
Ниже будет схема, которая наглядно показывает схему **существующего** варианта подключения и демонстрирует более безопасную схему **предлагаемую** схему.

![[docker-web.drawio]]

![[docker-web.drawio.png]]

---
## 2. Безопасность контейнеров от исполнения команд

На самом деле, очень спорный вариант. По скольку если злоумышленник получил доступ к тачке, то все пропало, однако можно прибегнуть к одному из нижеописанных вариантов.

### 2.1 Использование пространства имен

При инициализации **образа** или на этапе сборки **контейнера** может указать от какого пользователя он будет запускаться.

| Плюсы                                                   | Минусы                                                                                         |
| ------------------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| Пользователь внутри контейнера не будет иметь Root прав | Смонтированная папка должна иметь те же права, что и пользователь, который запускает контейнер |
| -                                                       | Остается возможность "провалиться" в контейнер                                                 |

### 2.2 Rootless dCOCKer

Даже при инициализации контейнера от пользователя, сервисы докера все также запускаются от имени рута и имеют больше прав и привилегий чем хотелось бы. Для этого можно запускать сам **Docker** в ***rootless*** режиме.

| Плюсы                                                                                                                                                     | Минусы                                                                                                                                                                                                                             |
| --------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Улучшенная безопасность: Рутлесс Docker позволяет запускать контейнеры без привилегий root, что уменьшает риск эксплойтов и несанкционированного доступа. | Ограниченные возможности: Контейнеры, работающие без привилегий root, имеют ограничения в доступе к некоторым системным ресурсам. Некоторые функции Docker, которые требуют привилегий root, могут быть недоступны или ограничены. |
|                                                                                                                                                           | Необходимость дополнительных настроек: Для использования rootless Docker потребуется настройка дополнительных параметров и разрешений, таких как создание и настройка пользовательских пространств имен, работа с сокетом Docker, а также ограничение доступа контейнера к файловой системе хост                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |


---

## 3. Дополнительные методы обеспечения безопасности

Помимо вышеперечисленных методов, существует также возможность дополнительно обезопасить контейнеры, ограничив доступ к ресурсам хоста.

### 3.1 Ограничение capabilities

Контейнеры *docker* могут иметь излишние привилегии, которые могут вызвать дополнительные риски и спровоцировать инциденты безопасности. При помощи ограничения привилегий можно выдать контейнеру только те права, которые ему нужны *(взаимодействие с ФС и сетью)* 

### 3.2 Использование опции no-new-privileges

При помощи опции ***no-new-privileges*** описанной в докер файле на этапе сборки ***образа***
можно ограничить доступ к получению новых привелегий (*ограничиваем контейнер пользовательским пространством имен + запрещаем ему становится рутом ... profit !)*
### 3.3 Применение AppArmor

К *docker* контейнерам можно также применить заранее созданный профиль **AppArmor**, который может:
- ограничить доступ к ФС
- ограничить сетевой доступ
- ограничить доступ к системным ресурсам
- ограничить привелегии приложения

### 3.4 Использование AuthZ плагина

Плагин движка докера (***Docker Engine***), позволяющий гибко настроить аутентификацию и права для пользователей. Основной цель - обезопасить **DOCKER API** (post и get запросы)

| Плюсы                                                      | Минусы |
| ---------------------------------------------------------- |:------:|
| Гибкая настройка аутентификации и прав                    | Защищает только доступ по API    |
| Можно выключить *docker exec* для отдельных пользователей | Требует установки дополнительных утилит       |
| Возможность аутентификации по токенам и/или LDAP                                                          |  -      |

## 4. Идеи и предложения

Есть крутая идея. ОТказаться от монтирования БД в систему хоста. И заменить её монтирование папки с бэкапами, а сами бэкапы генерировать внутри контейнера
___
### Zero-Links
- [[00 Docker]]
- [[00 YSTS]]
- [[00 Безопасность]]
- [[00 Linux]]

### Links
- [[Безопасность контейнеров в Linux]]
- [[Безопасность контейнеров]]
